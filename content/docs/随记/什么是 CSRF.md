---
title: 什么是 CSRF
date: 2024-12-25T10:33:13+08:00
author: LiangMingJian
---

‌**CSRF（Cross-Site Request Forgery，跨站请求伪造）**‌ 是一种网络攻击方式，攻击者通过诱导用户（在已登录目标网站的状态下）访问恶意网站或点击恶意链接，利用用户的身份和权限，在用户不知情的情况下向目标网站发起非用户本意的请求，从而执行未经授权的操作。

### ‌**CSRF 的核心原理**‌

1. ‌**用户已登录目标网站**‌：用户通过浏览器访问并登录了某个网站（如银行、社交平台等），服务器返回了包含用户身份信息的会话令牌（如 Cookie、Session ID）。
2. ‌**诱导访问恶意链接**‌：攻击者通过邮件、社交媒体、广告等手段，诱导用户点击一个精心构造的恶意链接或访问恶意网站。
3. ‌**伪造请求**‌：恶意网站或链接中包含对目标网站的请求（如转账、修改密码等），浏览器会自动携带用户的会话令牌（如 Cookie）发送请求。
4. ‌**服务器误判**‌：目标网站收到请求后，因会话令牌有效，误认为是用户主动发起的合法操作，从而执行攻击者指定的行为。

### ‌**CSRF 的典型攻击场景**‌

- ‌**转账攻击**‌：用户登录银行网站后，攻击者诱导用户点击一个链接，自动向攻击者账户转账。
- ‌**修改密码**‌：用户登录社交平台后，攻击者通过恶意链接修改用户密码。
- ‌**发布恶意内容**‌：用户登录论坛后，攻击者通过伪造请求发布垃圾信息或广告。

### ‌**CSRF 的特点**‌

1. ‌**隐蔽性**‌：攻击在用户无感知的情况下完成，用户可能完全不知道自己的账户被操作。
2. ‌**依赖会话**‌：攻击必须利用用户已登录的状态（会话令牌）。
3. ‌**跨站性**‌：攻击者通过第三方网站（非目标网站）发起请求。

### ‌**CSRF 的防御措施**‌

1. ‌**CSRF Token**‌：
    - 服务器在表单或请求中生成一个随机 Token，用户提交请求时需携带该 Token。
    - 服务器验证 Token 的合法性，确保请求来自合法来源。
2. ‌**同源策略**‌：
    - 浏览器默认禁止跨域请求（如 AJAX 请求），但需配合其他措施（如 CORS 配置）。
3. ‌**验证 Referer 头**‌：
    - 检查请求的 `Referer` 头，确认请求是否来自目标网站的域名。
4. ‌**双重 Cookie 验证**‌：
    - 在 Cookie 和请求参数中同时存储 Token，服务器验证两者是否一致。
5. ‌**禁用 GET 请求修改数据**‌：
    - 关键操作（如转账、修改密码）仅允许通过 POST/PUT/DELETE 等方法提交，并附加 CSRF Token。
6. ‌**使用 SameSite Cookie 属性**‌：
    - 设置 Cookie 的 `SameSite` 属性为 `Strict` 或 `Lax`，限制 Cookie 在跨站请求中的发送。

### ‌**示例：CSRF 攻击流程**‌

1. 用户登录银行网站 `bank.com`，浏览器存储了会话 Cookie。
2. 攻击者发送一封邮件，包含链接：`<img src="https://bank.com/transfer?to=attacker&amount=1000">`。
3. 用户点击链接后，浏览器自动向 `bank.com` 发送请求，携带用户的 Cookie。
4. 银行服务器收到请求，因 Cookie 有效，执行转账操作。

### ‌**总结**‌

CSRF 是一种利用用户身份的隐蔽攻击，通过伪造请求实现非法操作。防御的核心是‌**验证请求的合法性**‌（如 CSRF Token、Referer 检查、SameSite Cookie 等）。开发者需在关键操作中实施防护措施，用户也应保持警惕，避免点击可疑链接。
---
title: 06计算机网络基础知识
date: 2023-04-10
author: LM
---

## 1.OSR / IM 7 层模型

### 1.1  模型内容

- 应用层，面向用户，对应设备：电脑各种数据。
- 表示层，面向用户，对应设备：处理用户信息表示问题，如编码，数据格式转换，加密解密。
- 会话层，面向用户，对应设备：会话管理，流量控制，寻址。
- 传输层，数据传输，对应设备：各种协议。
- 网络层，数据传输，对应设备：路由器。
- 数据链路层，数据传输，对应设备：交换机，网桥。
- 物理层，数据传输，对应设备：集线器，中继器。

![](/images/drawingbed/img/202308231015168.png)

### 1.2 各层模型对应协议

![](/images/drawingbed/img/202307040936913.png)

## 2.路由器

### 2.1 路由的定义

- 路由是指把信息从源穿过网络传递到目的地的行为，其包含两个基本的动作，分别是确定最佳路径（选择路径）和通过网络传输信息（交换）。
- 路由器是指工作在OSI第3层（网络层）上，具有连接不同网络并选择数据传送路径的网络设备。
- 软路由是指利用台式机或服务器配合软件形成路由解决方案，主要依靠软件设置来达成路由器的功能。
- 硬路由是指以专用的硬件设备来提供特定的路由器功能。
- 默认路由是当路由器没有其他路由可选时，最后选择的路由。

### 2.2 路由器的特征

- **工作在第3层网络层**：集线器工作在第1层物理层，没有智能处理能力，对他而言数据只是电流，当一个端口的电流传到集线器时，它只是简单地将其传送到其他端口。交换机工作在第2层，对交换机来说，它能分辨出数据的源MAC地址和目的MAC地址，因此可以在任意两个端口间建立联系。但交换机并不懂得IP地址。路由器工作在第3层，它能理解数据中的IP地址，当识别到目标地址在本地网络时则不处理，否则会将数据转发出本地网络。
- **能连接不同的网络**：常见的集线器和交换机一般用于连接以太网。如果需要连接两种不同类型的网络，如以太网和ATM网，则需要路由器。所以，实际上，通常说的互联网就是由各种路由器连接起来的多个网络。
- **具有路径选择能力**：在互联网中从一个节点到另一个节点具有多条路径，路由器可以选择通畅快捷的近路。提高通信速度，减轻网络系统通信负荷，并节约系统资源。
- **提供分割广播风暴，提高带宽利用率的功能**。

### 2.3 路由表

- 为保证路由器能选择出最佳路径，往往会在路由器中保存多种传输路径的相关数据，即路由表，以供路由选择使用。其中保存着子网的标志信息，网上路由器的个数和下个路由器的名字。

### 2.4 路由协议

- RIP 是 Internet 中常用的路由协议，路由器根据距离选择路由。
- OSPF 是一种基于链路状态的路由协议，需要每个路由器向同一管理员的所有其他路由器发送链路状态广播信息，OSPF 协议根据收集到的信息，通过一定算法计算出到每个节点的最短距离，并以此选择路由。

### 2.5 路由的匹配原则

- **管理距离决定了路由的优先**，管理距离越小说明路由优先级更高。
- **路由选项的匹配应当遵循最长匹配原则**，选择掩码最长的一条路由。在路由表中选择路由时，应当将地址转为二进制表示，从左开始，选择相同位数最多的一条数据。

## 3.集线器

### 3.1 集线器的定义

- 集线器是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以其为中心的节点上的网络设备。
- 集线器属于纯硬件网络底层设备，所以其发送的数据没有针对性，只能使用广播方式进行数据传递，它把从一个端口接收的数据放大后向各个端口广播出去。

### 3.2 集线器的缺点

1. **数据通信不安全**，容易被非法截获。
2. **容易出现广播风暴问题**，由于采用共享带宽的广播方式，可能造成网络塞车现象。
3. **容易出现冲突域**，由于是非双工传输，同一时刻一个端口只能进行一个方向的数据通信，因此多个设备同时发送数据就会出现冲突域。

### 3.3 集线器的特点

1. 只是一个多端口的信号放大设备，在网络中起到**信号放大和重发**的作用。
2. **只与其上联设备通信**，同层的各端口之间不会直接通信。
3. 连接集线器的**设备出现故障不会波及到集线器**。

### 3.4 集线器的分类

1. **无源集线器**：不对信号做任何处理，只进行广播。
2. **有源集线器**：能放大和再生信号。
3. **智能集线器**：不仅具有有源集线器的功能，还具有网络管理和路由功能。

### 3.5 集线器的多级扩展

1. **堆叠**，从 UP 口连接另一台集线器的 DOWN 口。
2. **级联**，通过 Uplink 或 MDI 口进行级联。

## 4.交换机

- 交换机（Switch）是一种用于电（光）信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。
- 最常见的交换机是以太网交换机。其他常见的还有电话语音交换机、光纤交换机等。
- **交换机提供分割冲突域的功能**。

## 5.光纤

- **单模光纤**：只能传输一种模式的光。适用于远程通信，对光源的谱宽和稳定性有较高的要求
- **多模光纤**：可传输多种模式的光，因模间色散较大，从而限制了传输数字信号的频率，且随距离增加而更加严重。多模光纤的传输距离就比较近。

## 6.网络协议

### 6.1 网络协议的定义

- 网络协议是网络上所有设备（网络服务器、计算机及交换机、路由器、防火墙等）之间通信规则的集合，它规定了通信时信息必须采用的格式和这些格式的意义。
- 大多数网络都采用分层的体系结构，每一层都建立在它的下层之上，向它的上一层提供一定的服务。网络协议能为这样的不同层次提供数据交换的途径。

### 6.2 网络协议的三要素

- **语法**：规定数据与控制信息的结构或格式，包括数据的组织方式，编码方式以及信号电平的表示方式。
- **语义**：说明通信双方应当如何处理，用于协调与差错处理的控制信息。
- **定时**：称为同步或时序，即事件实现顺序的详细说明。 

## 7.TCP / IP 网络协议

### 7.1 TCP / IP 协议的定义

- TCP/IP 是基于 TCP 和 IP 这两个最初的协议之上的不同的通信协议的大集合，其包含多种不同的网络协议。
- TCP/IP 是一组不同层次上的多个协议的组合。 一般情况下，TCP/IP 被认为是一个四层协议，以OSR / IM 7 层模型为基础界定了每个阶层的协议和每个阶层之间接口相关的标准。

### 7.2 TCP / IP 协议的层次

- **应用层**：对应应用层，表示层，对话层。包括 FTP，Telnet，DNS，SMTP（邮件发送），POP3（邮件接收），IMAP（邮件获取），SNMP（网络管理协议，适用于UDP），HTTP，TFTP（简单文件传输），SSL，HTTPS 等网络协议。
- **传输层**：对应传输层。包括 TCP，UDP 等网络协议。
- **网络层**：对应网络层。包括 IP，ICMP，ARP，RARP 等网络协议。
- **接口层**：对应数据链路层和物理层。包括 PPP/PPPoE（点对点协议），Ethernet（以太网），HDLC/LLC（高级数据链路控制），FrameRelay（帧中断），ATM（异步传输模式）等网络协议。

![](https://gitee.com/LM-J/drawingbed/raw/master/img/202308231109139.png)

### 7.3 TCP 传输层协议

- TCP 传输控制协议，是 TCP/IP 协议簇传输层中最重要的一个协议。
- TCP 是面向连接的运输层协议。应用程序在使用 TCP 协议之前，必须先建立 TCP 连接。在传送数据完毕后，必须释放已经建立的 TCP 连接。每一条 TCP 连接只能有两个端点，每一条 TCP 连接只能是点对点的(一对一)
- TCP 提供全双工通信。TCP 允许通信双方的应用进程在任何时候都能发送数据。TCP 连接的两端都设有发送缓存和接受缓存，用来临时存放双向通信的数据。
- TCP 建立连接的过程叫做握手，握手需要在客户和服务器之间交换三个 TCP 报文段。客户向服务器发送连接请求，服务器向客户发送连接建立请求，客户向服务器确认建立连接。
- TCP 关闭连接的过程叫做挥手，握手需要在客户和服务器之间交换四个 TCP 报文段。客户向服务器发送关闭连接请求，服务器向客户发送收到关闭连接请求，确认关闭连接请求，客户向服务器确认连接关闭。
- TCP 连接的建立和关闭需要三次握手、四次挥手。

## 8.其他常见的网络协议

### 8.1 ICMP 网络层协议

- ICMP 互联网控制消息协议是互联网协议族的核心协议之一。它用于 TCP/IP 网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，使网络管理者可以对所发生的问题作出诊断，然后采取适当的措施解决问题。
- ICMP 是网络层协议，但是它不像 IP 协议和 ARP 协议一样直接传递给数据链路层，而是先封装成 IP 数据包然后再传递给数据链路层。所以在 IP 数据包中如果协议类型字段的值是 1 的话，就表示 IP 数据是 ICMP 报文。IP 数据包就是靠这个协议类型字段来区分不同的数据包的。
- 在日常工作中，ping，traceroute 命令是基于 ICMP 协议来实现的。

### 8.2 PPP 数据链路层协议

- PPP 点对点协议是互联网中广泛使用的数据链路层通信协议，它为点对点链路上直接相连的两个结点之间提供了一种数据传输的方式。
- PPP 是大多数个人计算机和 ISP 之间使用的协议，在高速广域网上也有一定的应用。

### 8.3 PPP 的两种认证协议

- 密码验证协议（PAP）使用双向握手为远程节点提供一个简单的设立身份的方法，通过用户名和密码在链路中明文不断的发送，直到鉴权完成或连接终止。
- 质询握手验证协议（CHAP）通过三次握手验证身份，比 PAP 更为安全，且不在链路中明文发送数据，支持单向和双向认证。

### 8.4 LDAP 会话层协议

- 轻型目录访问协议（LDAP）是一个开放的，中立的，工业标准的会话层协议。
- LDAP 通过 IP 协议提供访问控制和维护分布式信息的目录信息。

### 8.5 DHCP 应用层协议

- DHCP 动态主机配置协议是一种存在于应用层的网络管理协议。在 DHCP 的帮助下，可以动态地给网络上的任何设备或节点分配一个唯一的互联网协议 IP 地址，使它们可以使用这个 IP 进行通信。
- DHCP 使用 UDP 协议工作，统一使用 67（服务器端），68（客户端）端口。
- 在 DHCP 数据包中，可以包含客户机 MAC 地址，DHCP 服务器 IP，默认网关地址，DNS 服务器地址，以及分配给客户机的 IP 地址和掩码。

### 8.6 常用协议及其端口

| 端口号 | 描述                          |
| ------ | ----------------------------- |
| 21     | FTP 文件传输协议的端口号      |
| 23     | Telnet 远程终端协议的端口号    |
| 25     | SMTP 简单邮件传输协议的端口号  |
| 53     | DNS 域服务器所开放的端口       |
| 69     | TFTP 简单文件传送协议的端口号  |
| 80     | HTTP 超文本传输协议的端口号    |
| 443     | HTTPS 加密超文本传输协议的端口号    |
| 110    | POP3 邮局协议版本3的端口号     |
| 123    | NTP 网络时间协议的端口号       |
| 161    | SNMP 简单网络管理协议 的端口号 |
| 520    | RIP 路由信息协议的端口号       |

## 9.IP 网际互连协议

### 9.1 IP 协议

- IP 网际互连协议是整个 TCP/IP 协议簇的核心，也是构成互联网的基础。
- IP 位于 TCP/IP 模型的网络层，它可以向传输层提供各种协议的信息。

### 9.2 IPv4 协议

- IPv4，Internet Protocol version4，网际协议第 4 版，是 TCP/IP 协议使用的数据报传输机制。
- IPv4 的数据报是一个可变长分组，由头部和数据两部分组成，头部长度可由 20~60 个字节组成，该部分包含有与路由选择和传输有关的重要信息。

### 9.3 IPv4 协议的缺点

- 即使借助子网化、无类寻址和 NAT 等技术提高 IPv4 地址的使用效率，但因特网中 IP 地址的耗尽仍然是一个没有彻底解决的问题。
- IPv4 没有提供对实时音频和视频传输这种要求传输最小时延的策略和预留资源支持。
- IPv4 不能对某些有数据加密和鉴别要求的应用提供支持。

### 9.4 IPv6 协议

- IPv6，Internet Protocol version6，网际协议第 6 版。
- 在 IPv6 中，IP 地址格式和分组长度以及分组的格式都改变了，IPv6 每个分组由必须的基本头部和其后的有效载荷组成，有效载荷由可选的扩展头部和来自上层的数据组成。
- 基本头部占用 40 字节，有效载荷可以包含 65535 字节数据。

### 9.5 IPv4 和 IPv6 数据交换

- **双协议栈**：主机同时运行 IPv4 和 IPv6 两套协议，同时支持 IPv4 和 IPv6
- **隧道技术**：这种机制用来在IPv4网络上连接IPv6的站点，通过将IPv6分组封装后在IPv4上传输，到达目的地后再恢复成IPv6
- **NAT-PT（翻译技术）**：利用转换网关来在IPv4和IPv6间转换IP报头地址，同时对分组进行语义翻译，使得纯IPv4和纯IPv6间能透明通信

### 9.6 子网的划分

- **A 类地址**，24 位分配给主机号（3个字节），8 位网络号，可划分 2^24 个子网
- **B 类地址**，16 位分配给主机号（16个字节），16 位网络号，可划分 2^16 个子网
- **C 类地址**，8 位分配给主机号（8个字节），24 位网络号，可划分 2^8 个子网
- **子网掩码** 255.255.255.192 是 1111-1111.1111-1111.1111-1111.1100-0000 ，一共有 26 个 1，为了简化表示，可以用 /26 代替 255.255.255.192。
- **子网数** = 2^n（n是向主机借位数量，比如掩码/24划分为掩码/26的子网，需要向主机位借26-24=2位，因此子网数=4）
- **可用主机数** = 2^主机号 - 2（在子网中，全0和全1的地址将作为网关和广播地址，无法被主机使用）

### 9.7 子网的计算

问题：存在子网 192.168.10.1/27，请计算这个网络有多少个子网？

解：显然这是一个 C 类 IP 地址，但子网掩码不是默认的 /24，所以它是一个划分过的子网。因为划分子网需要向主机位借位，因此：子网数 = 2^(27-24) = 8 个。

问题：存在子网 192.168.10.1/27，请计算子网中的主机数？和可用主机数？

解：由 /27 可知该子网的网络号为 27，显然主机号为 4 X 8 - 27 = 5，因此：主机数 = 2^5 = 32 台，可用主机数 = 32 - 2 = 30 台。

## 10.域名

### 10.1 域名的组合

- 一个域名是由几部分（有可能只是一部分，也许是两部分，三部分...）组成的简单结构，它被点分隔，不同于中文书写顺序，它**需要从右到左阅读**。
- 域名的每一部分都提供着特定信息，以 `http://www.sina.com.cn` 为例，http 是通信使用的协议，sina.com.cn 是域名，www 是提供服务的机器的名字（主机名）。

![](/images/drawingbed/img/202307040936763.png)

### 10.2 顶级域名

- TLD（Top-Level Domain，顶级域名）可以告诉用户域名所提供的服务类型。
- 顶级域名既可以包含拉丁字母，也可以包含特殊字符。
- 顶级域名最长可以达到 63 个字符，不过为了使用方便，大多数顶级域名都是两到三个字符。
- 顶级域名的完整列表是 ICANN 维护的。
- 一般的顶级域名：`.com, .org, .net`
- 地区的顶级域名：`.us, .fr, .sh`
- 包含 `.gov` 的顶级域名只能被政府部门使用。
- `.edu` 只能为教育或研究机构使用。

### 10.3 二级域名

- 域名支持分级，从后往前级别依次降低。
- 比如 sina.com.cn 中，cn 是顶级域名，表示中国，com 是二级域名，表示商业机构（commercial），sina 是三级域名，一般用自己的名字。

## 11.局域网

### 11.1 层次化局域网模型

- **核心层**的主要功能是将分组从一个区域高速的转发到另一个区域。核心层是因特网的高速骨干，由于其重要性，因此在设计中应采用冗余组件设计，使其具备高可靠性，能快速适应变化。在设计核心层设备的功能时，应尽量避免使用数据包过滤、策略路由等降低数据包转发处理的特性，以优化核心层获得低延迟和良好的可管理性。
- **汇聚层**是核心层和接入层的分界点，应尽量将资源访问控制、核心层流量的控制等都在汇聚层实施。汇聚层应向核心层隐藏接入层的详细信息，汇聚层向核心层路由器进行路由宣告时，仅宣告多个子网汇聚而形成的一个网络汇聚层也会对接入层屏蔽网络其它部分的信息，汇聚层路由器可以不向接入层路由器宣告其它网络部分的路由，而仅仅向接入设备宣告自己为默认路由。
- **接入层**要解决相邻用户之间的互访需要，并且为这些访问提供足够的宽带接入层还应该适当负责一些用户管理功能，包括地址认证、用户认证、计费管理等内容接入层还负责一些用户信息收集工作，例如用户的IP地址、MAC地址、访问日志等信息。

### 11.2 网络维护命令

| 命令 | 描述                          |
| ------ | ----------------------------- |
| ping     | Internet 包探索器，用于测试网络连接量      |
| tracert     | 路由跟踪实用程序    |
| netstat     | 显示网络连接，路由表，网络接口信息  |
| arp    | 确认对应IP地址的网卡物理地址       |
| nslookup    | DNS 解析查询  |
| ipconfig/renew    | 刷新 DHCP 缓存    |
| ipconfig/flushdns    | 刷新 DNS 存储    |

### 11.3 IIS 下多站点的配置

- **采用虚拟主机时**，发布的站点可以存在多个独立域名。
- **采用虚拟目录时**，发布的站点没有独立的域名，而是在主域名下建立虚拟目录。
---
title: 11数据库技术
date: 2023-04-18
author: LM
---

## 数据与信息

- 数据是描述事物的的符号记录，具有多种表现方式，可以是文字，图形，图像，声音和语言等。
- 信息是现实世界事物的存在方式或状态的反映。信息具有可感知，可存储，可加工，可传递和可再生等自然属性。信息是具有特定释义和意义的数据。

## 数据库基础概念

按照数据结构组织、存储和管理数据的仓库。本质是一个文件系统。保存一系列有组织的数据。每个数据库都有一个或者多个不同的API用于创建、访问、管理、搜索和复制所保存的数据。

## 数据库三级模式

数据库领域公认的标准结构是三级模式结构，它包括外模式、概念模式、内模式。

数据库的三级模式是数据库在三个级别 (层次)上的抽象，使用户能够逻辑地、抽象地处理数据而不必关心数据在计算机中的物理表示和存储。实际上 ，对于一个数据库系统而言，只有物理级数据库是客观存在的，它是进行数据库操作的基础，概念级数据库中不过是物理数据库的一种逻辑的、抽象的描述(即模式)，用户级数据库则是用户与数据库的接口，它是概念级数据库的一个子集(外模式)。

美国国家标准协会(ANSI)的数据库管理系统研究小组于1978年提出了标准化的建议，将数据库结构分成如下 3 级：

- **外模式**，面向用户或应用程序员的用户级，用户可以使用外模式描述语言来描述定义用户的数据记录，也可以用数据操纵语言 DML 来处理数据记录。外模式反应了数据库的用户观，对应数据库中的视图。
- **概念模式**，面向建立和维护数据库人员的概念级，它由数据模式描述语言 DDL 来描述并定义，体现和反应数据库系统的整体观，对应数据库中的基本表。
- **内模式**，面向系统程序员的物理级，是数据库的存储观，对应数据库中的存储文件。

## 数据控制功能

数据库管理系统提供下述4个方面的数据控制功能：

- **安全性控制**：防止不合法使用数据库造成数据的泄露和破坏，使每个用户只能按其规定对某些数据进行某种或某些操作和处理。安全性控制是指要尽可能杜绝所有可能的数据库非法访问，保护数据库以防止不合法使用造成的数据泄露、更改或破坏。
- **完整性控制**：系统通过设置一些完整性规则等约束条件，确保数据的正确性、有效性和相容性，防止错误的数据进入数据库造成无效操作。正确性是指数据的合法性，有效性是指数据是否在其定义的有效范围，相容性指表示同一事实的两个数据应相同。实施数据库完整性的方法：约束、默认值、规则、存储过程、触发器。
- **并发控制**：多名用户同时存取或修改数据库时，系统可防止由于相互干扰而提供给用户不正确的数据，并防止数据库受到破坏。实现并发控制的方法：封锁技术和时标记数。
- **数据恢复**：由于计算机系统的硬件故障、软件故障、操作员的误操作以及其他故意的破坏等原因，造成数据库中的数据不正确或数据丢失时，系统有能力将数据库从错误状态恢复到最近某一时刻的正确状态。

## 完整性约束

数据完整性约束指的是为了防止不符合规范的数据进入数据库。在用户对数据进行插入、修改、删除等操作时，数据库自动按照一定的约束条件对数据进行监测，使不符合规范的数据不能进入数据库，以确保数据库中存储的数据正确、有效、相容。

完整性约束分为以下内容：实体完整性，参照完整性，用户定义的完整性。其中**实体完整性与参照完整性是关系模型中必须满足的完整性约束条件。**

1. **实体完整性**：若属性 A 是基本关系的主属性，则属性 A 不能取空值。规定表的每一行在表中是唯一的实体。

2. **参照完整性**：两个表的主关键字和外关键字的数据应一致，保证了表之间的数据的一致性，防止了数据丢失或无意义的数据在数据库中扩散。

3. **用户定义的完整性**：用户设置对某些具体关系数据库的约束条件。

## 分布式数据库

分布式数据库系统通常使用较小的计算机系统，每台计算机可单独放在一个地方，每台计算机中都可能有DBMS（数据库管理系统）的一份完整拷贝副本，或者部分拷贝副本，并具有自己局部的数据库，位于不同地点的许多计算机通过网络互相连接，共同组成一个完整的、全局的逻辑上集中、物理上分布的大型数据库。

分布式数据库系统 （DDBS）包含分布式数据库管理系统（DDBMS）和分布式数据库（DDB)。在分布式数据库系统中，一个应用程序可以对数据库进行透明操作，数据库中的数据分别在不同的局部数据库中存储、由不同的DBMS进行管理、在不同的机器上运行、由不同的操作系统支持、被不同的通信网络连接在一起。

分布式数据库具有以下的透明特性：

- **分片透明**：指用户不必了解数据是如何分片的，用户或应用程序不需要知道逻辑上访问的表是怎么分块存储的。分片透明性是最高层次的透明性，如果用户能在全局关系一级操作，则数据如何分布，如何存储等细节自不必关系，其应用程序的编写与集中式数据库相同。
- **复制透明**：采用复制技术的分布方法，用户不知道数据是复制到哪些节点，如何复制的。用户不用关心数据库在网络中各个节点的复制情况。
- **位置透明**：用户不必知道所操作的数据放在何处，即数据分配到哪个或哪些站点存储对用户是透明的。
- **逻辑透明**：局部映像透明性（逻辑透明）是最低层次的透明性，该透明性提供数据到局部数据库的映像，即用户或应用程序无需知道局部使用是哪种数据模型、使用哪种数据操纵语言。局部映像透明性对异构型和同构异质的分布式数据库系统非常重要。

## 数据库管理员 DBA 的职责

- 决定数据库中信息内容和结构
- 决定数据库的存储结构和存储策略
- 定义数据库的安全性要求和完整性约束条件
- 监控数据库运行
- 数据库性能改进
- 数据库重组和重构
- 提高系统性能

## 数据库设计阶段

- **需求分析**：分析用户的需求，包括数据、功能和性能需求。
- **概念结构设计**：将需求分析得到的用户需求抽象为概念模型，并通过 E-R 图来对设计进行描述。
- **逻辑结构设计**：把概念结构设计阶段设计好的 E-R 图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构，即实现从 E-R 模型到关系模型的转换，进行关系的规范化。
- **物理结构设计**：主要是为所设计的数据库选择合适的存储结构和存储路径。
- **数据库实施**：包括编程、测试和试运行。
- **数据库运行和维护**：系统的运行和数据库的日常维护。

## E-R 模型

实体 - 联系模型，是概念数据模型的高层描述所使用的数据模型或模式图。其分为**实体**、**属性**、**关系**三个核心部分：

- **实体**：矩形表示，数据模型中的数据对象，例如门店、员工、物品都可以作为一个数据对象。每个实体都有自己的实体成员（entity member）或者说实体对象（entity instance），例如员工实体里包括张三、李四等，实体成员（entity member）/ 实体实例（entity instance） 不需要出现在ER图中。

  - **弱实体**：一个实体必须依赖于另一个实体存在，那么前者是弱实体，后者是强实体，弱实体必须依赖强实体存在，例如上图的门店实体和员工实体，员工依赖于门店实体而存在，因此门店是强实体，而员工是弱实体。弱实体和强实体的联系必然只有1：N或者1：1，这是由于弱实体完全依赖于强实体，强实体不存在，那么弱实体就不存在，所以弱实体是完全参与联系的，因此弱实体与联系之间的联系也是用的双线菱形。

  - **复合实体**：复合实体也称联合实体或桥接实体，常常用于实现两个或多个实体间的 M：N 联系，它由每个关联实体的主码组成，用长方体内加一个菱形来表示。以汽车美容门店的案例为例，车主和施工项目两个实体是M：N的关系，中间有施工订单这个实体联系，因此施工订单这个实体是一个复合实体，同时如果车主实体不存在，就没有施工订单实体的存在，因此对于车主实体来讲施工订单是弱实体，同理施工项目实体如果不存在，同样不存在施工订单实体，因此对施工项目实体而言施工订单是弱实体。

    ![](/images/drawingbed/img/202307041002357.png)

- **属性**：椭圆形表示，数据对象所具有的属性，例如员工具有姓名、工号、职位等属性，用椭圆形表示，属性分为唯一属性（ unique attribute）和非唯一属性，唯一属性指的是唯一可用来标识该实体实例或者成员的属性，用下划线表示，一般来讲实体都至少有一个唯一属性。ER图的属性还细分为复合属性、多值属性和派生属性、可选属性，同时还有用来表示联系的属性，称为联系属性。

  - **复合属性**：复合属性是指具有多个属性的组合，例如「姓名」属性，它可以包含「姓氏」属性和「名字」属性
  - **多值属性**：一个实体的某个属性可以有多个不同的取值，例如一辆车的「车型」属性，这辆车有多个「车型」，例如SUV、MPV等，这个「车型」就是多值属性， 用双线椭圆表示。
  - **派生属性**：是非永久性存于数据库的属性。派生属性的值可以从别的属性值或其他数据（如当前日期）派生出来，用虚线椭圆表示。
  - **可选属性**：并不是所有的属性都必须有值，有些属性的可以没有值，这就是可选属性，在椭圆的文字后用（O）来表示。
  - **联系属性**：联系属性用于表示多个实体之间联系所具有的属性，一般来讲M:N的两个实体的联系具有联系属性，在1:1和1：M的实体联系中联系属性并不必要。

- **联系**： 实体间的联系用菱形框表示，菱形内写明联系名，并使用无向边与相关的实体链接起来。无向边旁标注联系的类型。存在以下3种关系

  - **1对1（1:1）**：1对1关系是指对于实体集A与实体集B，**A中的每一个实体至多与B中一个实体有关系**，反之，在实体集B中的每个实体至多与实体集A中一个实体有关系。
  - **1对多（1:N）**：1对多关系是指实体集A与实体集B，A中一个实体至少与B中N(N>0)个实体有关系，并且**实体集B中每一个实体至多与实体集A中一个实体有关系**。在这种联系中，B应当存在外键与A相连。
  - **多对多（M:N）**：多对多关系是指**实体集A中的每一个实体与实体集B中至少有M(M>0)个实体有关系**，并且**实体集B中的每一个实体与实体集A中的至少N（N>0）个实体有关系**。多对多联系转换为关系时，必须转为一个独立的关系，其属性由双方实体主码和联系的属性组成。

![](/images/drawingbed/img/202307041002516.png)

## 数据库规范化

利用规范化理论，使关系模式的函数依赖集满足特定的要求，满足特定要求的关系模式叫做范式。关系按此规范化程度从低到高可分为 5 级范式，分别称为 1NF、2NF、3NF ( BCNF）、 4NF、5NF。规范化程度较高者必是较低者的子集，即 5NF ⊆ 4NF⊆BCNF⊆3NF⊆2NF⊆1NF，一个低一级范式的关系模式，通过模式分解可以转换成若干个高一级范式的关系模式的 集合，这个过程称作规范化。

- **1NF**：消除组中的重复，也就是说列中是否存储了其他列中的信息（**每个字段不可再分**）
- **2NF**：消除部分依赖列，也就是说是否有依赖于一部分主键的列（**不存在部分依赖，非主键字段完全依赖主键字段**）
- **3NF**：消除非依赖列，不存在依赖于非主键的列（**不存在传递依赖**）
- **BCNF**：消除部分和依赖列（**不存在部分和依赖传递**）
- **4NF**：消除非平凡且非函数依赖的多值依赖（**在全键表中，键的一部分能确定至多其他一个字段的多个值**）（存在多值属性的情况时，应该将该实体的码和相关的多值属性独立构成一个关系模式）
- **5NF**：消除不是由候选码所蕴含的连接依赖

## 函数依赖

X->Y 被称为 X 函数决定 Y，或 Y 函数依赖于 X。例如有关系，学生（学号 S#，姓名 SN，系名 SD），子集 X（学号），子集 Y（系名）。每个学生都有唯一的学号，学生可以重名，每个学生只属于一个系，每个系有唯一的系代号，于是有下面的函数依赖：S# -> SN       S# -> SD

1. **完全函数依赖**：在关系中，如果 X -> Y，对与 X 的任意一个真子集 X'，都不存在 X' -> Y，则称 Y 对 X 完全依赖。例如，在成绩表（学号，课程，成绩）关系中，有函数依赖：（学号，课程）-> 成绩，但学号不决定成绩，课程不决定成绩，所以（学号，课程）->成绩 是完全函数依赖
2. **平凡函数依赖**：在关系中，如果 X ->Y，但 X 包含 Y，则称 X→Y 是平凡的函数依赖。如：关系R(Sno, Cno)，依赖关系(Sno, Cno)→Sno，(Sno, Cno)→Cno都是平凡函数依赖。
3. **非平凡函数依赖**：在关系中，如果 X→Y，但 X 不包含 Y，则称 X→Y 是非平凡的函数依赖。如：关系R(Sno, Cno, Grade)，依赖关系(Sno, Cno)→Grade是非平凡函数依赖。
4. **部分函数依赖**：在关系中，如果 X -> Y，但 Y 不完全依赖于 X，存在 X 的子集使得 X1 -> Y，则称 Y 对 X 部分函数依赖。
5. **传递函数依赖**：在关系中，当且仅当 X->Y，Y->Z 时，称 Z 对 X 传递函数依赖。例如，S# -> SB，SB -> TN，即 TN 传递函数依赖于 S#

## 视图

数据库视图是基于SQL语句结果集的一个可视化表，在一个查询需要频繁作为子查询使用时，视图可以简化代码，可以直接调用。数据库视图就像一个真实的表，包含行和列，是从一个或几个基本表（或视图）中导出的虚拟的表，对应了一个查询结果，在系统的数据字典中仅存放了视图的定义，不存放视图对应的数据。视图在数据库管理系统中也是一个对象，也是以文件形式存在的。

![](/images/drawingbed/img/202307041002772.png)

## 视图与表的区别

- 视图是已经编译好的 SQL 语句，而表不是；
- 视图没有实际的物理记录，而表有；
- 表是内容，视图是窗口；
- 表占用物理空间而视图不占用物理空间，视图只是逻辑概念的存在，表可以及时对它进行修改，但视图只能用创建的语句来修改；
- 表是内模式，试图是外模式；
- 视图是查看数据表的一种方法，可以查询数据表中某些字段构成的数据，只是一些 SQL 语句的集合，从安全的角度说，视图可以不给用户接触数据表，从而不知道表结构；
- 表属于全局模式中的表，是实表，视图属于局部模式的表，是虚表；
- 视图的建立和删除只影响视图本身，不影响对应的基本表；
- 不能对视图进行 update 或者 insert into 操作。

## SQL 语句

- SQL 语句对大小写不敏感。
- 某些数据库系统要求在每条 SQL 命令的末端使用分号，分号是在数据库系统中分隔每条 SQL 语句的标准方法，这样就可以在对服务器的相同请求中执行一条以上的语句。
- SQL 语句中，字符类型字段需要使用单引号。
- `SELECT 列名称 FROM 表名称`，从表中选取数据。
- `SELECT 列名称 FROM 表名称 WHERE 列 运算符 值`，有条件地从表中选取数据
- `ORDER BY 列`，排序，默认升序。
- `ORDER BY 列 DESC`， 排序，降序
- `INSERT INTO 列/表 VALUES 值`，插入
- `UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值`，更新值
- `GROUP BY 列`，用于配合合计函数 SUM，COUNT 等，根据一个或多个列对结果集进行分组
- `HAVING`，由于 WHERE 关键字无法与合计函数一起使用，需要使用 HAVING 来配合合计函数，查找特定结果
- `PRIMARY KEY (值)`：主键
- `FOREIGN KEY (值) PEFERENCES 另一个表 (值)`：外键
- `UCASE()，LCASE()`，大写与小写
- `CREATE VIEW view_name AS SELECT column_name(s) FROM table_name WHERE condition [WITH CHECK OPTION]`：创建视图，使用 `WITH CHECK OPTION` 保证对视图进行UPDATE等修改时，修改的数据会受到原来定义视图时WHERE的条件的影响
- `GRANT 权限 ON 数据库对象 TO 用户 [WITH GRANT OPTION]`：赋予用户权限，使用 `WITH GRANT OPTION` 表示用户可以将其的授权授予他人

## 关系计算

1. **广义笛卡尔积（×）**：设 A，B 为集合，用 A 中元素为第一元素，B 中元素为第二元素构成有序对，所有这样的有序对组成的集合叫做 A 与 B 的笛卡尔积，记作 A x B。例如，集合 A={a, b}，集合 B={0, 1, 2}，两个集合的笛卡尔积为 {(a, 0), (a, 1), (a, 2), (b, 0), (b, 1), (b, 2)}
2. **选择（$\sigma$）**：又称为限制，在关系 R 中选择满足给定条件的元组。例如：${\sigma_{A=a}}(r)=\{t|t\in r,t[A]=a\}$
3. **投影（$\pi$）**：选取关系中特定列的数据，去重后组成新的元组。例如：${\pi_{X}}(r)=\{t|t\in r,t[X]\}$
4. **连接（$><$）**：自然连接从关系中<u>选取具有相同元素的组进行合并</u>，并移除合并后的重复元素。例如：$R{><\atop{i \theta j}}S={\sigma_{i \theta j}}(R×S)$
5. **除（$\div$）**：设关系 R 除以关系 S 的结果为关系 T，则 T 包含所有在 R 但不在 S 中的属性及其值，且 T 的元组与 S 的元组的所有组合都在 R 中
6. 在关系运算中，应当提早执行选择运算，以得到较小的中间结果，减少运算量和从外存读取数据的此时。

![](/images/drawingbed/img/202307041002191.png)

该关系代数表示的意思是：先关系R与关系S进行自然连接运算，形成新的结果集，然后在新的结果集中进行选择运算，选择运算的条件是 第2列的值为“软件工程”，接下来再选择运算的结果集上再进行投影运算，选择 1 3 5 列。由于R与S关系中，存在重复的列C、D，因此需要在加上关系的名称，表示该列来自哪个关系，如： R.C。自然连接运算，要求在结果集中消除重复的列，即R与S关系中C、D列，只能保留一个关系中的C、D列，所以自然连接运算后的关系列一个有：5列即A、B、R.C（或者S.C）、R.D（或者S.D）、E。连接运算为R.C == S.C AND R.D == S.D。

## 关系计算的优化

- 提早执行选取运算。对于有选择运算的表达式，优化的原则可能先执行选择运算的等价表达式，以得到较小的中间结果，减少运算量和从外存读块的次数
- 合并乘积与其后的选择运算为连接运算。在表达式中，当乘积运算后面是选择运算时，应该合并为连接运算，使选择与乘积一道完成，以避免完成乘积后，再对一个大的乘积关系进行选择运算
- 将投影运算与其后的其他运算同时进行，以避免重复扫描关系
- 将投影运算和其后的二目运算结合起来，使得没有必要为去掉某些字段再扫描一遍关系
- 在执行连接前对关系做适当的预处理，就能快速地找到要连接的元组。方法有两种：即索引连接法和排序合并连接法
-  存储公共子表达式。公共子表达式的结果应存于外存（中间结果），这样，当从外存读出它的时间比计算时间少时，就可节约操作时间                

## 候选码

关系模式 R<U，F>，关系名 R，一组属性 U，属性组 U 上的一组数据依赖 F。设 K 为 R 中的属性或属性组合。若 U 完全函数依赖于 K，则称 K 为 R 的候选码。候选码可能多于一个，则选定其中一个为主码（主键）。

例如：一个学生，身份证可以唯一表示一个学生，学号也可以唯一标识一个学生，（身份证，学号）这个集合可以唯一标识一个学生。我们可以选学号或身份证来作为这个学生的主键，那么（身份证、学号）就是候选码。

## 主键

- 主键是数据表中唯一标识记录的属性，不能重复，不能为空，一个表只有一个主键。
- 主键可以由一个字段，也可以由多个字段组成，分别称为单字段主键或多字段主键，它可以唯一确定表中的一行数据，或者可以唯一确定一个实体。
- 多对多关系的主键大部分情况下由双方实体主码组合而成，并根据实际添加其他条件进行限制。

## 索引

索引的作用

1. 保证了数据的唯一性
2. 加快数据检索的速度
3. 加速表与表之间的连接，实现数据的参照完整性
4. 减少了在分组、排序的检索时间
5. 可以在查询过程中使用优化隐藏器来提高系统性能

索引的缺点

1. 创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。
2. 除了数据表占数据空间之外，每一个索引还要占一定的物理空间。
3. 当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。

创建索引的原则

1. 在经常需要搜索的列上，可以加快搜索的速度。
2. 在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构。
3. 在经常用在连接的列上，这些列主要是一些外键，可以加快连接的速度。
4. 在经常需要根据范围进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的。
5. 在经常需要排序的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间。
6. 在经常使用在where子句中的列上面创建索引，加快条件的判断速度。

不应该创建索引的原则

1. 对于那些在查询中很少使用或者参考的列不应该创建索引。这是因为，既然这些列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。
2. 对于那些只有很少数据值的列也不应该增加索引。这是因为，由于这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度。
3. 对于那些定义为 text，image 和 bit 数据类型的列不应该增加索引。这是因为，这些列的数据量要么相当大，要么取值很少，此时全表扫描会比索引更快。
4. 当修改性能远远大于检索性能时，不应该创建索引。这是因为，修改性能和检索性能是互相矛盾的。当增加索引时，会提高检索性能，但是会降低修改性能。当减少索引时，会提高修改性能，降低检索性能。因此，当修改性能远远大于检索性能时，不应该创建索引。

## 数据库安全机制

1. 用户标识和鉴别
2. 授权和回收
3. 数据库角色
4. 视图机制：将要保密的数据对无权的用户进行隐藏
5. 审计：记录用户对数据库的所有操作
6. 数据加密：防止数据库中数据在存储和传输中的失密

